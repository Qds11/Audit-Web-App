<%- include("./partials/NFBheaderSectionThree") %>
<script src="https://cdn.jsdelivr.net/npm/js-cookie@rc/dist/js.cookie.min.js"></script>
<script src="https://smtpjs.com/v3/smtp.js"></script>  
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
<link rel="stylesheet" href="/css/fullpage.css" />
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
<div class="ui main text container">
  <br>
  <br>
  <button type="button" class="btn btn-success btn-lg" onclick="GenPDF()">Download PDF</button>
  <button type="button" class="btn btn-warning btn-lg" onclick="GenMessage()" data-toggle="modal" data-target="#myModal" >Share Link</button>
  <div class="modal fade" id="myModal" role="dialog">
    <div class="modal-dialog">
    
      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title">Email Link to Checklist</h4>
        </div>
        <div class="modal-body">
    
        <label for="receiverEmail">To</label>
        <span class="help-block"  id="userEmailError" >Please check the email address format.</span>
    <input class="modal-input" type="text" id="receiverEmail" name="receiverEmail"  onblur="checkUserEmail()">
   
    <label for="subject">Subject</label>
    <input class="modal-input" type="text" id="subject" name="subject" >

   

    <label for="message">Message</label>
    <textarea class="modal-input" id="message" name="message" style="height:200px"></textarea>


        
        </div>
        <div class="modal-footer">
         <button type="button" class="btn btn-default" id="sendEmail" onclick="ShareLink()" data-dismiss="modal" disabled>Send</button>
          <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
        </div>
      </div>
      
    </div>
  </div>
  <form
  class="ui form"
  id='form'
   
  <br>
  <br>

  <div class="ui huge header"><%= NFBName %>  Non-F&B Audit Checklist </div>
  
      <tr>
   
      <td><h4>Name of checklist:  <%= NFBName %> </h4></td>
      
    </tr>
    <tr>
      <td><h4>Instituion:      
      <%= NFBinstituteName %></h4>
        
      
      </td>
    </tr>
    <tr>
      
      <td> <h4>Retail Tenant:  <%= NFBrentalName%></h4></td>
           
      </td>
    </tr>
  </tr>
  <tr>
   
    <td><h4>Date:   
      <%= NFBauditSubmissionDate%></h4>
        </td>
   
  </tr>
    <table>
      <input
        type="hidden"
        name="checklist[sessionEmail]"
    
      />
      <tr>
        <th>1. Lorem, ipsum dolor sit amet consectetur adipisicing elit. (20%)</th>
        <th>Point(s) Awarded</th>
      </tr>
      <tr style= "background-color: #add1b0">
        <td  class = "greenTr">Professionalism</td>
        <td class = "greenTr"></td>
      </tr>
      <tr>
        <td>
          Lorem, ipsum dolor sit amet consectetur adipisicing elit.
        </td>
        <td name="checklist[1]" class="questions1">      
          <%= NFBData[0]%>
        </td>
      </tr>
      <tr>
        <td>Lorem, ipsum dolor sit amet consectetur adipisicing elit.</td>
        <td name="checklist[2]" class="questions1" >
           
          <%= NFBData[1]%>
        </td>
      </tr>
      <tr>
        <td>ALorem, ipsum dolor sit amet consectetur adipisicing elit.</td>
        <td name="checklist[3]" class="questions1">
          <%= NFBData[2]%>
        </td>
      </tr>
      <tr style= "background-color: #add1b0">
        <td  class = "greenTr">Staff Hygiene</td>
        <td  class = "greenTr"></td>
      </tr>
      <tr>
        <td>
            Lorem, ipsum dolor sit amet consectetur adipisicing elit.
        </td>
        <td name="checklist[4]" class="questions1" >
          <%= NFBData[3]%>
           
        </td>
      </tr>
      <tr>
        <td>
            Lorem, ipsum dolor sit amet consectetur adipisicing elit.
        </td>
        <td  name="checklist[5]" class="questions1">
          <%= NFBData[4]%>
        </td>
      </tr>
      <tr>
        <td>
           Lorem, ipsum dolor sit amet consectetur adipisicing elit.
        </td>
        <td  name="checklist[6]" class="questions1">
          <%= NFBData[5]%>
           
        </td>
      </tr>
      <tr style= "background-color: #dddddd">
        <td class = "greenTr">Score:</td>
        <td class = "greenTr">
            <%= NFBSectionOneTotal%>
        </td>
      </tr>
    </table>
    <table> 
      <tr class="html2pdf__page-break"  style= "background-color: #dddddd">
       <h5> Remarks:       <%= NFBSectionOneRemarks%></h5>
      
      
   
      </tr>
    </table>
    <img id="SectionOneImage"  height="80%" max-height="400pt"  max-width="670pt"width="80%" />
    <img id="SectionOneImage2"  class="html2pdf__page-break"  height="80%" max-height="400pt"  max-width="670pt"width="80%" />
    <table> 
      <tr>
        <tr >
            <th>2. Lorem, ipsum dolor sit amet consectetur adipisicing elit.(40%)</th>
            <th>Point(s) Awarded</th>
          </tr>
          <tr style= "background-color: #add1b0">
            <td  class = "greenTr">General Environment Cleanliness</td>
            <td  class = "greenTr"></td>
          </tr>
      <tr>
        <td> Lorem, ipsum dolor sit amet consectetur adipisicing elit.
            <p>➢  Lorem, ipsum dolor sit amet consectetur adipisicing elit.</p>
          
          
        </td>
        <td name="checklist[7]" class="questions1">
           
          <%= NFBData[6]%>
        </td>
      </tr>
      <tr>
        <td>
            Lorem, ipsum dolor sit amet consectetur adipisicing elit.
        </td>
        <td  name="checklist[8]" class="questions1">
          <%= NFBData[7]%>
           
        </td>
      </tr>
      <tr>
        <td>
            Lorem, ipsum dolor sit amet consectetur adipisicing elit.
        </td>
        <td name="checklist[9]" class="questions1" >
           
          <%= NFBData[8]%>
        </td>
      </tr>
      <tr>
        <td>
          Lorem, ipsum dolor sit amet consectetur adipisicing elit.
        </td>
        <td  name="checklist[10]"
        class="questions1">
          
        <%= NFBData[9]%>
           
           
        </td>
      </tr>
      <tr>
        <td>
           Lorem, ipsum dolor sit amet consectetur adipisicing elit.
        </td>
        <td name="checklist[11]"
        class="questions1">
          
        <%= NFBData[10]%>
           
           
        </td>
      </tr>
      <tr>
        <td>Lorem, ipsum dolor sit amet consectetur adipisicing elit.</td>
        <td name="checklist[12]"
        class="questions1">
          
        <%= NFBData[11]%>
           
           
        </td>
      </tr>
      <tr>
        <td>   Lorem, ipsum dolor sit amet consectetur adipisicing elit.
         
        <td name="checklist[13]"
        class="questions1">
          
            
        <%= NFBData[12]%>
           
        </td>
      </tr>
      
     
        
      <tr>
        <td>
           Lorem, ipsum dolor sit amet consectetur adipisicing elit.
        </td>
        <td name="checklist[14]"
        class="questions2">
        <%= NFBData[13]%>
            
           
           
        </td>
      </tr>
      <tr>
        <td>Lorem, ipsum dolor sit amet consectetur adipisicing elit.</td>
        <td  name="checklist[15]"
        class="questions2">
       
        <%= NFBData[14]%>
           
        </td>
      </tr>
      <tr>
        <td> SLorem, ipsum dolor sit amet consectetur adipisicing elit.</td>
        <td name="checklist[16]"
        class="questions2">
        <%= NFBData[15]%>
            
           
           
        </td>
      </tr>
      <tr>
        <td>Lorem, ipsum dolor sit amet consectetur adipisicing elit.</td>
        <td  name="checklist[17]"
        class="questions2">
          
        <%= NFBData[16]%>
           
           
        </td>
      </tr>
      <tr>
        <td>Lorem, ipsum dolor sit amet consectetur adipisicing elit.</p> <p>➢ Lorem, ipsum dolor sit amet consectetur adipisicing elit.</p> </td>
        <td name="checklist[18]"
        class="questions2">
          
            
        <%= NFBData[17]%>
           
        </td>
      </tr>
      <tr style= "background-color: #dddddd">
        <td class = "greenTr">Score:</td>
        <td class = "greenTr">
            <%= NFBSectionTwoTotal%>
        </td>
      </tr>
    </table>
      <table> 
        <tr class="html2pdf__page-break"  style= "background-color: #dddddd">
         <h5> Remarks: <%= NFBSectionTwoRemarks%></h5>
        
         
     
        </tr>
      </table>
        </td>
      </tr >
    </table>
    <img id="SectionTwoImage"  height="80%" max-height="400pt"  max-width="670pt"width="80%" />
    <img id="SectionTwoImage2"  class="html2pdf__page-break"  height="80%" max-height="400pt"  max-width="670pt"width="80%" />
    <table> 
      <tr>
        <th>3. Lorem, ipsum dolor sit amet consectetur adipisicing elit. (40%)</th>
        <th>Point(s) Awarded</th>
      </tr>
      <tr style= "background-color: #add1b0">
        <td class = "greenTr">General Safety</td>
        <td class = "greenTr"></td>
      </tr>
      <tr>
        <td>Lorem, ipsum dolor sit amet consectetur adipisicing elit.</td>
        <td name="checklist[19]"
        class="questions2"
       >
       <%= NFBData[18]%>
            
           
        </td>
      </tr>
      <tr>
        <td>Lorem, ipsum dolor sit amet consectetur adipisicing elit.</td>
        <td name="checklist[20]"
        class="questions2">
          
        <%= NFBData[19]%>
           
           
        </td>
      </tr>
      <tr>
        <td>
           Lorem, ipsum dolor sit amet consectetur adipisicing elit.
        </td>
        <td name="checklist[21]"
        class="questions2">
        <%= NFBData[20]%>
            
           
           
        </td>
      </tr>
      <tr>
        <td>
            Lorem, ipsum dolor sit amet consectetur adipisicing elit.
        </td>
        <td name="checklist[22]"
        class="questions2">
          
        <%= NFBData[21]%>
            
            
           
           
        </td>
      </tr>
      <tr>
        <td>
           Lorem, ipsum dolor sit amet consectetur adipisicing elit.
        </td>
        <td  name="checklist[23]"
        class="questions2">
          
        <%= NFBData[22]%>
           
           
        </td>
      </tr>
      <tr>
        <td>
            Lorem, ipsum dolor sit amet consectetur adipisicing elit.
        </td>
        <td      name="checklist[24]"
        class="questions2">
        <%= NFBData[23]%>
     
           
        </td>
      </tr>
      <tr>
        <td>
            Lorem, ipsum dolor sit amet consectetur adipisicing elit.
        </td>
        <td name="checklist[25]"
        class="questions2">
        <%= NFBData[24]%>
            
           
           
        </td>
      </tr>
      <tr>
        <td>  Lorem, ipsum dolor sit amet consectetur adipisicing elit.</td>
        <td name="checklist[26]"
        class="questions2">
          
        <%= NFBData[25]%>
           
           
        </td>
      </tr>
      <tr>
        <td>
           Lorem, ipsum dolor sit amet consectetur adipisicing elit.
        </td>
        <td name="checklist[27]"
        class="questions2">
          
        <%= NFBData[26]%>
           
           
        </td>
      </tr>
      <tr style= "background-color: #add1b0">
        <td class = "greenTr">Fire & Emergency Safety</td>
        <td class = "greenTr"></td>
      </tr>
      <tr>
        <td>
           Lorem, ipsum dolor sit amet consectetur adipisicing elit.
        </td>
        <td  name="checklist[28]"
        class="questions2">
        <%= NFBData[27]%>
           
           
           
        </td>
      </tr>
      
      <tr>
        <td>
          Lorem, ipsum dolor sit amet consectetur adipisicing elit.
        </td>
        <td name="checklist[29]"
        class="questions2">
          
        <%= NFBData[28]%>
           
           
        </td>
      </tr>
      <tr>
        <td>
            FLorem, ipsum dolor sit amet consectetur adipisicing elit.
        </td>
        <td    name="checklist[30]"
        class="questions2">
          
        <%= NFBData[29]%>
           
           
        </td>
      </tr>
      <tr style= "background-color: #add1b0">
        <td class = "greenTr">Electrical Safety</td>
        <td class = "greenTr"></td>
      </tr>
      
      
      
        
      <tr>
        <td>
            Lorem, ipsum dolor sit amet consectetur adipisicing elit.
        </td>
        <td name="checklist[31]"
        class="questions3">
        <%= NFBData[30]%>
            
           
           
        </td>
      </tr>
      <tr>
        <td>
            PLorem, ipsum dolor sit amet consectetur adipisicing elit.
        </td>
        <td name="checklist[32]"
        class="questions3">
        <%= NFBData[31]%>
            
           
           
        </td>
      </tr>
      <tr>
        <td>  Lorem, ipsum dolor sit amet consectetur adipisicing elit.</td>
        <td name="checklist[33]"
        class="questions3">
          
            
        <%= NFBData[32]%>
           
        </td>
      </tr>
      <tr>
        <td>ELorem, ipsum dolor sit amet consectetur adipisicing elit..</td>
        <td name="checklist[34]"
        class="questions3">
          
            
        <%= NFBData[33]%>
           
           
        </td>
      </tr>
      <tr style= "background-color: #dddddd">
        <td class = "greenTr">Score:</td>
        <td class = "greenTr">
            <%= NFBSectionThreeTotal%>
        </td>
      </tr>
    </table>
    <table> 
      <tr class="html2pdf__page-break"  style= "background-color: #dddddd">
       <h5> Remarks: 
        <%= NFBSectionThreeRemarks%></h5>
      
   
      </tr>
   
    </table>

  <img id="SectionThreeImage"   height="80%" max-height="400pt"  max-width="670pt"width="80%" />
  <img id="SectionThreeImage2"   height="80%" max-height="400pt"  max-width="670pt"width="80%" />
  </form>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.0.272/jspdf.debug.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.3.0/jspdf.umd.min.js" integrity="sha512-GctVjwNNH1cjfoaMyi3WTXq/Y+NDpQ2q+tVPGtNNCgmKiokNiWR68MMYbgaCLg5IgHgZ3dM8EVcmRpJVBLkaiA==" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.8.1/html2pdf.bundle.js"></script> 
  <script src='https://raw.githack.com/eKoopmans/html2pdf/master/dist/html2pdf.bundle.js'></script>
  <script scr='script.js'></script>
  <script>
     
    var imageOne=<%- JSON.stringify( NFBSectionOneImage)%>;
  //console.log(imageOne)
  document.getElementById("SectionOneImage").src=imageOne;
  if (imageOne==""){
    var imgOne = document.getElementById("SectionOneImage");
    imgOne.remove();
  }
  var imageOne2=<%- JSON.stringify( NFBSectionOneImage2)%>;
  //console.log(imageOne)
  document.getElementById("SectionOneImage2").src=imageOne2;
  if (imageOne2==""){
    var imgOne2 = document.getElementById("SectionOneImage2");
    imgOne2.remove();
  }
  var imageTwo=<%- JSON.stringify( NFBSectionTwoImage)%>;
 // console.log(imageTwo)
  document.getElementById("SectionTwoImage").src=imageTwo;
  if (imageTwo==""){
    var imgTwo = document.getElementById("SectionTwoImage");
    imgTwo.remove();
  }
  var imageTwo2=<%- JSON.stringify( NFBSectionTwoImage2)%>;
 // console.log(imageTwo)
  document.getElementById("SectionTwoImage2").src=imageTwo2;
  if (imageTwo2==""){
    var imgTwo2 = document.getElementById("SectionTwoImage2");
    imgTwo2.remove();
  }
  var imageThree=<%- JSON.stringify( NFBSectionThreeImage)%>;
  //console.log(imageThree)
  document.getElementById("SectionThreeImage").src=imageThree;
  if (imageThree==""){
    var imgThree = document.getElementById("SectionThreeImage");
    imgThree.remove();
  }
  var imageThree2=<%- JSON.stringify( NFBSectionThreeImage2)%>;
  //console.log(imageThree)
  document.getElementById("SectionThreeImage2").src=imageThree2;
  if (imageThree2==""){
    var imgThree2 = document.getElementById("SectionThreeImage2");
    imgThree2.remove();
  }
 function GenMessage(){
  var ID=<%- JSON.stringify(dataID)%>;
  var  sessionLogin=<%- JSON.stringify(sessionLogin)%>;
  document.getElementById("message").value = 'Link to checklist http://localhost:3000/View-NFB/' + ID+"/"+sessionLogin; 
}
function checkUserEmail(){
    //gets user input
    var email = document.getElementById("receiverEmail");
    //correct email format
    var userEmailFormate = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
    var flag;
    if(email.value.match(userEmailFormate)){
        flag = false;
    }else{
        flag = true;
    }
    //if input email doesn't match the correct email format, text to prompt user to input an email with a correct format is displayed 
    if(flag){
        document.getElementById("userEmailError").style.display = "block";
        document.getElementById('receiverEmail').style.borderColor = "red";
        document.getElementById("sendEmail").disabled = true;
    }else{//if input email matches the correct email format, text to prompt user is not displayed
        document.getElementById("userEmailError").style.display = "none";
        document.getElementById('receiverEmail').style.borderColor = "lightgray";
        document.getElementById("sendEmail").disabled = false;
    }
}
  function ShareLink(){
    let receiverEmail= document.getElementById('receiverEmail');
    let subject= document.getElementById('subject');
    let message= document.getElementById('message');
    var userEmailFormate = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
    var checkUserEmailValid = receiverEmail.value.match(userEmailFormate);
    if (checkUserEmailValid !=null){
      document.getElementById("sendEmail").disabled = false;
    let contactInfo = {
      receiverEmail:receiverEmail.value,
      subject:subject.value,
      message:message.value
    }
    console.log(contactInfo)
    var ID=<%- JSON.stringify(dataID)%>;
    let xhr=new XMLHttpRequest();
    xhr.open('POST','/sendEmail');
    xhr.setRequestHeader('content-type','application/json');
    xhr.onload=function(){
      console.log(xhr.responseText);
      if (xhr.responseText=='success'){
        alert("Email sent.")
        receiverEmail.value="",
        subject.value="",
        message.value=""
   
      }else{
        alert("Error. Email was not sent.")
        receiverEmail.value="",
        subject.value="",
        message.value=""
        
      }
    }
    xhr.send(JSON.stringify(contactInfo))
  } else{
    document.getElementById("userEmailError").style.display = "block";
    document.getElementById('email').style.borderColor = "red";
    document.getElementById("sendEmail").disabled = true;
  }

  }
   function GenPDF(){
    event.preventDefault();
    var name = '<%- JSON.stringify(NFBName) %>'
    var insti = '<%- JSON.stringify(NFBinstituteName) %>'
   
   var currentDate = new Date()
   var    day = currentDate.getDate()
   var  month = currentDate.getMonth() + 1
   var   year = currentDate.getFullYear()
   if (month<10){
     month="0"+month.toString()
   }
   else{
    month=month.toString()
   }
   if (day<10){
     day="0"+day.toString()
   }
   else{
     day=day.toString()
   }
   var   date = day + month+ year.toString();
    console.log(date)
   // var ten = '<%-  JSON.stringify(NFBrentalName, null, 2)%>'
   //console.log(ten)

       var element = document.getElementById ('form');
       var opt = {
   margin:       1,
   filename:     name+date+'.pdf',
   image:        { type: 'JPEG', quality: 0.90,},
   html2canvas:  { scale: 2 },
   jsPDF:        { unit: 'in', format: 'letter', orientation: 'portrait' }
 };
 
 // New Promise-based usage:
   html2pdf().set(opt).from(element).save();

 
   }
  
  

  </script>
  <script>
    localStorage.clear();
  </script>
</div>
<%- include("./partials/footer") %>
